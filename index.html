<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Junks Finan√ßas v50</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --bg: #0b101b; --card: #1a2234; --accent: #00f298;
            --blue: #3b82f6; --danger: #ff5252; --text: #f8fafc; --sub: #94a3b8;
            --border: rgba(255, 255, 255, 0.1);
        }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 20px; padding-bottom: 100px; }
        
        .container { max-width: 1100px; margin: auto; display: none; }
        .grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
        @media (min-width: 900px) { .grid { grid-template-columns: 320px 1fr; } }

        .card { background: var(--card); padding: 20px; border-radius: 24px; border: 1px solid var(--border); margin-bottom: 20px; }
        .balance-card { text-align: center; padding: 40px 20px; background: radial-gradient(circle at top, rgba(0,242,152,0.15), transparent); border-radius: 32px; margin-bottom: 25px; border: 1px solid rgba(0,242,152,0.2); }
        
        input, select, button { width: 100%; padding: 15px; margin-bottom: 12px; border-radius: 14px; border: 1px solid var(--border); font-size: 16px; transition: 0.3s; }
        input, select { background: #0b101b; color: white; }
        button { background: var(--accent); color: #000; font-weight: 800; border: none; cursor: pointer; }
        button:active { transform: scale(0.97); }
        
        .item-gasto { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(255,255,255,0.03); border-radius: 16px; margin-bottom: 10px; border: 1px solid var(--border); }
        .btn-del { color: var(--danger); background: none; border: none; width: auto; padding: 5px; margin: 0; }

        #loginScreen { position: fixed; inset: 0; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
    </style>
</head>
<body>

<div id="loginScreen">
    <div class="card" style="width: 100%; max-width: 400px; text-align: center;">
        <h1 style="color: var(--accent); font-size: 28px; margin-bottom: 10px;">Junks Finan√ßas</h1>
        <p style="color: var(--sub); font-size: 14px; margin-bottom: 30px;">Fa√ßa login para sincronizar PC e Celular</p>
        <input type="email" id="email" placeholder="Seu e-mail">
        <input type="password" id="password" placeholder="Sua senha">
        <button onclick="autenticar()">Acessar Minha Conta</button>
        <p id="errorMsg" style="color: var(--danger); font-size: 12px; margin-top: 10px;"></p>
    </div>
</div>

<div class="container" id="app">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <span id="userDisplay" style="font-size: 12px; color: var(--sub); font-weight: 600;"></span>
        <button onclick="auth.signOut()" style="width: auto; background: rgba(255,255,255,0.05); color: var(--sub); padding: 8px 15px; font-size: 12px;">Sair</button>
    </div>

    <div class="balance-card">
        <small style="letter-spacing: 2px; font-weight: 800; color: var(--sub);">SALDO DISPON√çVEL</small>
        <h1 id="sobraGeral" style="font-size: 50px; margin: 10px 0; color: var(--accent);">R$ 0,00</h1>
        <input type="month" id="mesFiltro" onchange="carregar()" style="width: auto; background: none; border: none; font-weight: 800; color: var(--accent); cursor: pointer;">
    </div>

    <div class="grid">
        <div class="col">
            <div class="card">
                <h3 style="margin-top: 0; font-size: 14px; color: var(--blue);">‚öôÔ∏è AJUSTES DO M√äS</h3>
                <label style="font-size: 11px; color: var(--sub);">META DE GASTOS (TETO)</label>
                <input type="number" id="tetoMes" placeholder="Ex: 2000" onchange="salvarAjustes()">
                <label style="font-size: 11px; color: var(--sub);">SALDO ATUAL EM CONTA</label>
                <input type="number" id="saldoConta" placeholder="Ex: 500" onchange="salvarAjustes()">
            </div>
            
            <div class="card">
                <h3 style="margin-top: 0; font-size: 14px; color: var(--accent);">üìä RESUMO POR CATEGORIA</h3>
                <div id="resumoCategorias"></div>
            </div>
        </div>

        <div class="col">
            <div class="card">
                <h3 style="margin-top: 0; font-size: 14px;">üí∏ NOVO LAN√áAMENTO</h3>
                <input type="text" id="desc" placeholder="O que voc√™ comprou?">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <input type="number" id="valor" placeholder="Valor R$">
                    <select id="categoria">
                        <option value="Essencial">üè† Essencial</option>
                        <option value="Lazer">üé° Lazer</option>
                        <option value="Sa√∫de">üíä Sa√∫de</option>
                        <option value="Outros">üì¶ Outros</option>
                    </select>
                </div>
                <button onclick="adicionarGasto()">Lan√ßar Gasto</button>
            </div>

            <h3 style="font-size: 14px; color: var(--sub); margin-left: 10px;">HIST√ìRICO DO M√äS</h3>
            <div id="listaGastos"></div>
        </div>
    </div>
</div>

<script>
    // CREDENCIAIS OFICIAIS (ATUALIZADAS)
    const firebaseConfig = {
        apiKey: "AIzaSyAUA30227CxibvN8bpZigFYJ845PVIWG_E",
        authDomain: "junks-financas.firebaseapp.com",
        databaseURL: "https://junks-financas-default-rtdb.firebaseio.com",
        projectId: "junks-financas",
        storageBucket: "junks-financas.firebasestorage.app",
        messagingSenderId: "566948589515",
        appId: "1:566948589515:web:8b2fbfbef22ad95e4a104e"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    let uid = null;
    let dadosLocal = { meses: {} };

    // Autentica√ß√£o
    function autenticar() {
        const e = document.getElementById("email").value, p = document.getElementById("password").value;
        if(!e || !p) return alert("Preencha tudo!");
        auth.signInWithEmailAndPassword(e, p).catch(() => auth.createUserWithEmailAndPassword(e, p))
            .catch(err => document.getElementById("errorMsg").innerText = "Erro: " + err.message);
    }

    auth.onAuthStateChanged(user => {
        if(user) {
            uid = user.uid;
            document.getElementById("loginScreen").style.display = "none";
            document.getElementById("app").style.display = "block";
            document.getElementById("userDisplay").innerText = "üë§ " + user.email;
            db.ref('users/' + uid).on('value', snap => {
                if(snap.exists()) dadosLocal = snap.val();
                carregar();
            });
        } else {
            document.getElementById("loginScreen").style.display = "flex";
            document.getElementById("app").style.display = "none";
        }
    });

    document.getElementById("mesFiltro").value = new Date().toISOString().slice(0, 7);

    function carregar() {
        const mesRef = document.getElementById("mesFiltro").value;
        const mesObj = dadosLocal.meses[mesRef] || { teto: 0, saldo: 0, itens: [] };
        
        document.getElementById("tetoMes").value = mesObj.teto || "";
        document.getElementById("saldoConta").value = mesObj.saldo || "";

        const lista = document.getElementById("listaGastos");
        lista.innerHTML = "";
        let totalGasto = 0;
        let resumo = { Essencial: 0, Lazer: 0, Sa√∫de: 0, Outros: 0 };

        (mesObj.itens || []).forEach((item, index) => {
            totalGasto += item.v;
            resumo[item.c] += item.v;
            lista.innerHTML += `
                <div class="item-gasto">
                    <div>
                        <small style="color:var(--blue); font-weight:bold; font-size:10px; text-transform:uppercase;">${item.c}</small><br>
                        <strong>${item.d}</strong>
                    </div>
                    <div style="text-align:right">
                        <strong>R$ ${item.v.toFixed(2)}</strong><br>
                        <button class="btn-del" onclick="removerGasto(${index})">excluir</button>
                    </div>
                </div>`;
        });

        // Atualiza Resumo de Categorias
        const divRes = document.getElementById("resumoCategorias");
        divRes.innerHTML = "";
        for(let c in resumo) {
            if(resumo[c] > 0) divRes.innerHTML += `<div style="display:flex; justify-content:space-between; font-size:13px; margin-bottom:8px;"><span>${c}</span> <b>R$ ${resumo[c].toFixed(2)}</b></div>`;
        }

        const sobra = (mesObj.teto + mesObj.saldo) - totalGasto;
        const display = document.getElementById("sobraGeral");
        display.innerText = "R$ " + sobra.toFixed(2);
        display.style.color = sobra < 0 ? "var(--danger)" : "var(--accent)";
    }

    function salvarAjustes() {
        const mesRef = document.getElementById("mesFiltro").value;
        if(!dadosLocal.meses[mesRef]) dadosLocal.meses[mesRef] = { itens: [] };
        dadosLocal.meses[mesRef].teto = parseFloat(document.getElementById("tetoMes").value) || 0;
        dadosLocal.meses[mesRef].saldo = parseFloat(document.getElementById("saldoConta").value) || 0;
        db.ref('users/' + uid).set(dadosLocal);
    }

    function adicionarGasto() {
        const d = document.getElementById("desc").value, v = parseFloat(document.getElementById("valor").value), c = document.getElementById("categoria").value;
        if(!d || !v) return;
        const mesRef = document.getElementById("mesFiltro").value;
        if(!dadosLocal.meses[mesRef]) dadosLocal.meses[mesRef] = { teto: 0, saldo: 0, itens: [] };
        if(!dadosLocal.meses[mesRef].itens) dadosLocal.meses[mesRef].itens = [];
        
        dadosLocal.meses[mesRef].itens.push({ d, v, c });
        document.getElementById("desc").value = ""; 
        document.getElementById("valor").value = "";
        db.ref('users/' + uid).set(dadosLocal);
    }

    function removerGasto(idx) {
        const mesRef = document.getElementById("mesFiltro").value;
        dadosLocal.meses[mesRef].itens.splice(idx, 1);
        db.ref('users/' + uid).set(dadosLocal);
    }
</script>
</body>
</html>
